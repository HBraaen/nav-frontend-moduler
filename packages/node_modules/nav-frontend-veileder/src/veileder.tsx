import * as React from 'react';
import * as PT from 'prop-types';
import * as cn from 'classnames';

import { omit } from 'nav-frontend-js-utils';
import VeilederSnakkeboble from './veileder-snakkeboble';

import 'nav-frontend-veileder-style'; // eslint-disable-line import/extensions

const cls = (props) => cn('veileder', {
    'veileder--warning': props.type === 'advarsel',
    'veileder--error': props.type === 'feilmelding',
    'veileder--success': props.type === 'suksess'
});

const frameCls = (props) => cn('veileder__frame', {
    'veileder__frame--center': props.sentrer,
    'veileder__frame--transparent': props.transparent,
    'veileder__frame--nomask': props.utenMaske
});

function getChatBubble(sier, veilederBredde){
    if (typeof sier !== 'undefined' && sier) {
        return <VeilederSnakkeboble sier={sier} offset={veilederBredde} />
    }
}

export interface VeilederProps {
    bredde?: number;
    children: React.ReactNode | React.ReactChild | React.ReactChildren;
    sier?: React.ReactNode | React.ReactChild | React.ReactChildren;
    farge?: string;
    transparent?: boolean;
    utenMaske?: boolean;
    sentrer?: boolean;
    type?: 'normal' | 'suksess' | 'advarsel' | 'feilmelding';
};

interface FrameStyle {
    background?: string;
    width?: number;
    height?: number;
};

class Veileder extends React.Component<VeilederProps> { // eslint-disable-line react/prefer-stateless-function
    render() {
        const {
            children,
            sier,
            farge,
            transparent,
            bredde,
            ...other
        } = this.props;

        const domProps = omit(
            { ...other },
            'sentrer',
            'utenMaske'
        );

        const frameStyles: FrameStyle = {};

        if (!transparent && farge) {
            frameStyles.background = farge;
        }

        if (bredde) {
            frameStyles.width = bredde;
            frameStyles.height = bredde;
        }

        return (
            <div className={cls(this.props)} {...domProps}>
                <div className={frameCls(this.props)} style={frameStyles}>{children}</div>
                {getChatBubble(sier, bredde || 230)}
            </div>
        );
    }
}

(Veileder as any).propTypes = {
    /**
     * Definerer størrelsen på Avataren. Kan angis helt fritt, og snakkeboblen vil posisjoneres
     * og snakkeboble-pilen vil skalere basert på denne verdien.
     */
    bredde: PT.number,
    /**
     * Custom SVG-element som illustrerer en figur, f.eks. en av disse:
     * https://app.zeplin.io/project/59831e455850985791bdeb4d/screen/5a7c1fcc36781f9423ab6a0e
     */
    children: PT.node.isRequired,
    /**
     * Tekst eller HTML som rendres i en snakkeboble
     */
    sier: PT.node,
    /**
     * Hex-fargecode som definerer bakgrunnsfarge, @navLysGra er default
     */
    farge: PT.string,
    /**
     * Skrur av bakgrunnsfargen
     */
    transparent: PT.bool,
    /**
     * Skrur av sirkulær maskering/cropping av children
     */
    utenMaske: PT.bool,
    /**
     * Skrur av 80% height på children, og rendrer i full høyde (hvis innholdet skal sentreres)
     */
    sentrer: PT.bool,
    /**
     * Predefinerte nøkler for styling av snakkeboblen, avhengig av type budskap.
     */
    type: PT.oneOf(['normal', 'suksess', 'advarsel', 'feilmelding'])
};

(Veileder as any).defaultProps = {
    transparent: false,
    utenMaske: false,
    sentrer: false,
    type: 'normal'
};

export default Veileder;
